---
title: 'Course Project 2: Storm Data Analysis'
author: "Sarah E. Wright"
date: "March 31, 2017"
output: html_document
---

```{r setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(stringdist)
library(lubridate)
```

## Synopsis


## Data Processing

Data were obtained from the NOAA storm database, which records information about major weather events and their effects. 

### Reading in the data

The data are stored as a csv file compressed with the bzip2 algorithm, which can be read into a dataframe using `read.csv()`. For the purpose of this project, we are only interested in the health and economic effects of weather events across the entire United States, so we'll select out only the relevant columns once we have our raw data. 
```{r cache=TRUE}
rawdata <- read.csv("repdata%2Fdata%2FStormData.csv.bz2")
stormdata <- select(rawdata,c(EVTYPE,BGN_DATE,FATALITIES,INJURIES,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP))
```

### Cleaning up the data

First, we'll exclude pre-1996 data. According to the documentation, years prior to 1996 only include a small subset of possible weather event types. From January 1996 onward, there are 48 event types included in the database.

```{r}
stormdataclean <- mutate(stormdata, DATE = mdy_hms(BGN_DATE))
stormdataclean <- filter(stormdataclean, year(DATE) >= 1996)
stormdataclean <- droplevels(stormdataclean)
```


#### Caluclate numeric values for property and crop damage from PROPDMG, CROPDMG, and their exponents

The PROPDMGEXP and CROPDMGEXP fields store the multipliers for the PROPDMG (property damage) and CROPDMG (crop damage) fields, respectively. These fields were messy in the original dataset, but fortunately the data from 1996 onwards is much more consistent. B stands for billion, M for million, K for thousand, and 0 for no multiplier.
```{r}
summary(stormdataclean$PROPDMGEXP)
summary(stormdataclean$CROPDMGEXP)
```

To make the property and crop damage estimates easier to summarize, we'll calculate two new fields for the total property and crop damage instead of relying on the exponenent fields.
```{r}
exponentkey <- data.frame(EXP = c("0","B","K","M"),PROPMULT = c(1,1000000000,1000,1000000))

```


#### Group on event type. We'll ignore date for now, although this might be an interesting variable to take into account later.

#### Clean up the event type field. There should only be 48 event types. We'll use the stringdist package.

## Results

### Across the U.S., which types of events are most harmful with respect to population health?

### Across the U.S., which types of events have the greatest economic consequences?